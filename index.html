<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>智汇单据系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{
            --primary:#1a73e8;
            --sidebar-width:220px;
            --sidebar-collapsed:50px;
            --sidebar-header-height:65px;
            --header-height:32px;
            --transition:all .3s ease;
        }
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI','Microsoft YaHei',sans-serif;}
        body{display:flex;height:100vh;overflow:hidden;background:#f0f4f8;color:#333;}

        /* ===== 侧边栏 ===== */
        .sidebar{
            width:var(--sidebar-width);
            background:linear-gradient(135deg,#1a2a6c,#2c3e50);
            color:#fff;
            position:fixed;
            height:100vh;
            transition:var(--transition);
            z-index:100;
            overflow-y:auto;
        }
        .sidebar.collapsed{width:var(--sidebar-collapsed);}
        .sidebar-header{
            display:flex;align-items:center;justify-content:space-between;
            padding:0 10px;height:var(--sidebar-header-height);
            border-bottom:1px solid rgba(255,255,255,.1);
            font-size:.85rem;
        }
        .logo{display:flex;align-items:center;gap:6px;font-weight:600;}
        .toggle-btn{background:rgba(255,255,255,.15);border:none;color:#fff;border-radius:50%;width:22px;height:22px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;font-size:.75rem;}
        .toggle-btn:hover{background:rgba(255,255,255,.25);}
        .sidebar-menu{padding:8px 0;}
        .menu-item{margin-bottom:2px;}
        .menu-title{padding:8px 12px;display:flex;align-items:center;cursor:pointer;font-size:.9rem;font-weight:500;transition:var(--transition);}
        .menu-title:hover{background:rgba(255,255,255,.1);}
        .menu-title i{margin-right:10px;font-size:1rem;width:20px;text-align:center;color:#a0d2ff;}
        .submenu{background:rgba(0,0,0,.15);display:none;}
        .submenu.active{display:block;}
        .submenu-item{padding:6px 12px 6px 42px;cursor:pointer;font-size:.8rem;display:flex;align-items:center;}
        .submenu-item:hover{background:rgba(255,255,255,.08);}
        .sidebar.collapsed .logo h2,
        .sidebar.collapsed .menu-title span,
        .sidebar.collapsed .submenu{display:none;}
        .sidebar.collapsed .menu-title{justify-content:center;padding:8px 0;}
        .sidebar.collapsed .menu-title i{margin-right:0;font-size:1.1rem;}

        /* ===== 主内容区 ===== */
        .main-content{
            flex:1;
            margin-left:var(--sidebar-width);
            transition:var(--transition);
            display:flex;
            flex-direction:column;
            height:100vh;
        }
        .sidebar.collapsed~.main-content{margin-left:var(--sidebar-collapsed);}
        .header{
            height:var(--header-height);
            background:#fff;
            box-shadow:0 1px 4px rgba(0,0,0,.05);
            display:flex;
            align-items:center;
            padding:0 12px;
            flex-shrink:0;
            font-size:1rem;
            font-weight:600;
            display:none;        /* 主页时隐藏 */
        }
        /* ---- 标签栏 ---- */
        .tabs{
            display:flex;
            background:#fafbfc;
            border-bottom:1px solid #e0e6f0;
            flex-shrink:0;
            display:none;        /* 主页时隐藏 */
        }
        .tab{
            padding:6px 12px;
            font-size:.8rem;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:6px;
            border-right:1px solid #e0e6f0;
            white-space:nowrap;
        }
        .tab.active{background:#fff;border-bottom:2px solid var(--primary);}
        .tab-close{color:#999;font-size:.7rem;margin-left:4px;}
        .tab-close:hover{color:#d93025;}
        /* ---- 内容区 ---- */
        .content{
            flex:1;
            display:flex;
            flex-direction:column;
            overflow:auto;
        }
        .tab-panel{
            display:none;
            flex:1;
        }
        .tab-panel.active{
            display:flex;
            flex-direction:column;
        }
        /* 统一上移 35px（除特殊页面外） */
        iframe{
            flex:1;
            border:none;
            margin-top:-35px;
        }
        iframe[data-nomove]{
            margin-top:0;
        }
        .split-container{
            flex:1;
            display:flex;
            position:relative;
        }
        .split-left,.split-right{
            flex:1;
            border:none;
        }
        .split-left{
            border-right:1px solid #e0e6f0;
        }
        .swap-btn{
            position:absolute;
            top:4px;
            left:50%;
            transform:translateX(-50%);
            z-index:10;
            background:var(--primary);
            color:#fff;
            border:none;
            padding:3px 8px;
            border-radius:3px;
            cursor:pointer;
            font-size:11px;
        }
    </style>
</head>
<body>
    <!-- 侧边栏 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"><i class="fas fa-file-invoice"></i><h2>智汇单据</h2></div>
            <button class="toggle-btn" id="toggleBtn"><i class="fas fa-bars"></i></button>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item">
                <div class="menu-title" onclick="goto('home','主页','single','https://www.kdocs.cn/wo/sl/v11tAJZk')">
                    <i class="fas fa-home"></i><span>主页</span>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-title" onclick="toggleSubmenu('dataReg')">
                    <i class="fas fa-clipboard-list"></i><span>数据登记</span><i class="fas fa-chevron-down" style="margin-left:auto;font-size:.7rem;"></i>
                </div>
                <div class="submenu" id="dataReg">
                    <div class="submenu-item" onclick="goto('wz','无纸化收单','single','https://kdocs.cn/l/ckee7mJnjuIW')">无纸化收单</div>
                    <div class="submenu-item" onclick="goto('sd','收单登记','split','https://www.kdocs.cn/wo/sl/v14dSwGd','https://www.kdocs.cn/l/cqOBfg5woE11?from=docs&embed=1&hide=1')">收单登记</div>
                    <div class="submenu-item" onclick="goto('dz','打单做账登记','single','https://www.kdocs.cn/wo/sl/v12naO01')">打单做账登记</div>
                    <div class="submenu-item" onclick="goto('yc','异常单登记','single','https://www.kdocs.cn/wo/sl/v11xPZ9y')">异常单登记</div>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-title" onclick="toggleSubmenu('dataManage')">
                    <i class="fas fa-database"></i><span>数据管理</span><i class="fas fa-chevron-down" style="margin-left:auto;font-size:.7rem;"></i>
                </div>
                <div class="submenu" id="dataManage">
                    <div class="submenu-item" onclick="goto('sdData','收单数据','single','https://www.kdocs.cn/wo/sl/v11p8MmT')">收单数据</div>
                    <div class="submenu-item" onclick="goto('agent','代理数据','single','https://www.kdocs.cn/wo/sl/v121kOPE')">代理数据</div>
                    <div class="submenu-item" onclick="goto('dzData','打单做账数据','single','https://www.kdocs.cn/wo/sl/v11yP7M2')">打单做账数据</div>
                    <div class="submenu-item" onclick="goto('ycData','异常单数据','single','https://www.kdocs.cn/wo/sl/v1NM4FF')">异常单数据</div>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-title" onclick="toggleSubmenu('dataQuery')">
                    <i class="fas fa-search"></i><span>数据查询</span><i class="fas fa-chevron-down" style="margin-left:auto;font-size:.7rem;"></i>
                </div>
                <div class="submenu" id="dataQuery">
                    <div class="submenu-item" onclick="goto('sdQuery','收单查询','single','https://www.kdocs.cn/etapps/query/q/rYGEPaM0')">收单查询</div>
                    <div class="submenu-item" onclick="goto('ycQuery','异常单展示','single','https://www.kdocs.cn/wo/sl/v11MkQ2e')">异常单展示</div>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-title" onclick="toggleSubmenu('dataAnalysis')">
                    <i class="fas fa-chart-line"></i><span>数据分析</span><i class="fas fa-chevron-down" style="margin-left:auto;font-size:.7rem;"></i>
                </div>
                <div class="submenu" id="dataAnalysis">
                    <div class="submenu-item" onclick="goto('stat','数据统计','single','https://www.kdocs.cn/wo/sl/v12mnYEt')">数据统计</div>
                    <div class="submenu-item" onclick="goto('viz','数据可视化','single','')">数据可视化</div>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-title" onclick="toggleSubmenu('aboutSystem')">
                    <i class="fas fa-info-circle"></i><span>关于系统</span><i class="fas fa-chevron-down" style="margin-left:auto;font-size:.7rem;"></i>
                </div>
                <div class="submenu" id="aboutSystem">
                    <div class="submenu-item" onclick="goto('bind','员工号绑定','single','https://web.wps.cn/wo/sl/v31Bmr3z?app_id=5IXSM8MjQrYBI9tXidNxyq')">员工号绑定</div>
                    <div class="submenu-item" onclick="goto('switch','切换账号','single','https://account.wps.cn/?cb=https%3A%2F%2Fdocs.wps.cn%2Fcrossdomain.html%3Faction%3DwebLoginSuccess%26tcb%3Dhttps%253A%252F%252Fwww.kdocs.cn%252Flatest&autologin=false')">切换账号</div>
                    <div class="submenu-item" onclick="goto('help','系统说明','single','https://kdocs.cn/l/cdeCQXZdMEnf')">系统说明</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主内容 -->
    <div class="main-content">
        <div class="header" id="pageHeader">主页</div>
        <div class="tabs" id="tabs"></div>
        <div class="content" id="content">
            <!-- 主页默认 -->
            <div class="tab-panel active" id="home">
                <iframe src="https://www.kdocs.cn/wo/sl/v11tAJZk"></iframe>
            </div>
        </div>
    </div>

    <script>
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggleBtn');
        const tabsBar = document.getElementById('tabs');
        const content = document.getElementById('content');
        const pageHeader = document.getElementById('pageHeader');
        const specialPages = new Set(['打单做账登记','异常单登记']);
        let tabCounter = 0;

        toggleBtn.addEventListener('click', () => sidebar.classList.toggle('collapsed'));
        
        function toggleSubmenu(id) {
            document.getElementById(id).classList.toggle('active');
        }

        // 统一跳转/创建
        function goto(id, title, type, url1, url2) {
            // 主页特殊处理
            if (id === 'home') {
                // 隐藏标签栏和标题栏
                tabsBar.style.display = 'none';
                pageHeader.style.display = 'none';
                
                // 移除所有标签页
                while (tabsBar.firstChild) {
                    tabsBar.removeChild(tabsBar.firstChild);
                }
                
                // 移除除主页外的所有内容面板
                const panels = content.querySelectorAll('.tab-panel:not(#home)');
                panels.forEach(panel => panel.remove());
                
                // 显示主页并隐藏其他面板
                [...content.children].forEach(panel => {
                    if (panel.id === 'home') {
                        panel.classList.add('active');
                        panel.style.display = 'flex';
                    } else {
                        panel.classList.remove('active');
                        panel.style.display = 'none';
                    }
                });
                return;
            }

            // 已存在直接切
            if (document.getElementById(id)) {
                activeTab(id);
                return;
            }

            // 显示标签栏和标题栏
            tabsBar.style.display = 'flex';
            pageHeader.style.display = 'flex';
            
            // 创建新标签页
            if (type === 'split') {
                addSplitTab(id, title, url1, url2);
            } else {
                addSingleTab(id, title, url1);
            }
        }

        function activeTab(id) {
            // 更新标签激活状态
            [...tabsBar.children].forEach(t => {
                t.classList.toggle('active', t.dataset.id === id);
            });
            
            // 更新面板激活状态
            [...content.children].forEach(p => {
                if (p.id === id) {
                    p.classList.add('active');
                    p.style.display = 'flex';
                } else {
                    p.classList.remove('active');
                    p.style.display = 'none';
                }
            });
            
            // 更新页面标题
            pageHeader.textContent = document.querySelector(`.tab[data-id="${id}"]`).textContent.replace(/[\n\r]+|[\s]{2,}/g, ' ').trim();
        }

        function addSingleTab(id, title, url) {
            // 创建标签
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.id = id;
            tab.textContent = title;
            
            // 创建关闭按钮
            const closeIcon = document.createElement('i');
            closeIcon.className = 'fas fa-times tab-close';
            closeIcon.onclick = (e) => closeTab(e, id);
            
            tab.appendChild(closeIcon);
            tab.onclick = () => activeTab(id);
            tabsBar.appendChild(tab);
            
            // 创建内容面板
            const panel = document.createElement('div');
            panel.className = 'tab-panel';
            panel.id = id;
            
            const iframe = document.createElement('iframe');
            iframe.src = url;
            
            // 特殊页面不需要偏移
            if (specialPages.has(title)) {
                iframe.setAttribute('data-nomove', '');
            }
            
            panel.appendChild(iframe);
            content.appendChild(panel);
            
            // 激活新标签
            activeTab(id);
        }

        function addSplitTab(id, title, leftUrl, rightUrl) {
            // 创建标签
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.id = id;
            tab.textContent = title;
            
            // 创建关闭按钮
            const closeIcon = document.createElement('i');
            closeIcon.className = 'fas fa-times tab-close';
            closeIcon.onclick = (e) => closeTab(e, id);
            
            tab.appendChild(closeIcon);
            tab.onclick = () => activeTab(id);
            tabsBar.appendChild(tab);
            
            // 创建内容面板
            const panel = document.createElement('div');
            panel.className = 'tab-panel';
            panel.id = id;
            
            panel.innerHTML = `
                <div class="split-container">
                    <button class="swap-btn" onclick="swapFrames(this)">切换</button>
                    <iframe src="${leftUrl}"></iframe>
                    <iframe src="${rightUrl}"></iframe>
                </div>
            `;
            
            content.appendChild(panel);
            
            // 激活新标签
            activeTab(id);
        }

        function closeTab(e, id) {
            e.stopPropagation();
            const tab = tabsBar.querySelector(`[data-id="${id}"]`);
            const panel = document.getElementById(id);
            
            if (!tab || !panel) return;
            
            tab.remove();
            panel.remove();
            
            // 无标签时回到主页
            if (!tabsBar.children.length) {
                goto('home', '主页', 'single', 'https://www.kdocs.cn/wo/sl/v14128NB');
            } else {
                activeTab(tabsBar.children[0].dataset.id);
            }
        }

        function swapFrames(btn) {
            const container = btn.parentElement;
            const frames = container.querySelectorAll('iframe');
            
            if (frames.length === 2) {
                const tempSrc = frames[0].src;
                frames[0].src = frames[1].src;
                frames[1].src = tempSrc;
            }
        }

        // 初始化
        window.onload = function() {
            document.getElementById('dataReg').classList.add('active');
            
            // 确保主页正确显示
            document.getElementById('home').style.display = 'flex';
        };
    </script>
</body>
</html>