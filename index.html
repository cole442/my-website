<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="智汇单据 - 智汇单据">
    <title>智汇单据</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --primary-dark: #1a252f;
            --secondary-color: #3498db;
            --secondary-dark: #2980b9;
            --active-color: #16a085;
            --text-color: #333;
            --light-text: #fff;
            --border-color: #ddd;
            --loading-bg: rgba(255, 255, 255, 0.9);
            --transition-time: 0.3s;
            --nav-width: 140px;
            --menu-item-height: 40px;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            overflow-x: hidden;
            color: var(--text-color);
        }
        
        /* 优化后的导航栏样式 */
        .nav {
            display: flex;
            flex-direction: column;
            width: var(--nav-width);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 10px;
            color: var(--light-text);
            transition: transform var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .nav h2 {
            margin: 0;
            padding: 15px 0;
            font-size: 1.1rem;
            text-align: center;
            font-weight: bold;
            color: var(--light-text);
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }
        
        .nav button {
            margin: 5px 0;
            width: 100%;
            height: var(--menu-item-height);
            padding: 0 15px;
            font-size: 14px;
            border: none;
            background: linear-gradient(to right, var(--secondary-color), var(--secondary-dark));
            color: var(--light-text);
            cursor: pointer;
            transition: all var(--transition-time) ease;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            text-align: left;
        }
        
        .nav button:hover, .nav button:focus {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            background: linear-gradient(to right, var(--secondary-dark), #1a5276);
            outline: none;
        }
        
        .nav button:active {
            transform: translateX(5px) scale(0.98);
        }
        
        .nav button::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background-color: var(--light-text);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }
        
        .nav button[data-active="true"] {
            background: linear-gradient(to right, var(--secondary-dark), #1a5276);
        }
        
        .nav button[data-active="true"]::after {
            transform: scaleY(1);
        }
        
        .nav button .arrow {
            transition: transform var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav button[data-expanded="true"] .arrow {
            transform: rotate(90deg);
        }
        
        .submenu {
            display: none;
            margin: 0 0 10px 10px;
            padding-left: 10px;
            list-style: none;
            border-left: 2px dashed rgba(255, 255, 255, 0.1);
            transition: max-height 0.3s ease, opacity 0.2s ease;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        
        .nav button[aria-expanded="true"] + .submenu {
            display: block;
            max-height: 500px;
            opacity: 1;
        }
        
        .submenu li {
            margin: 4px 0;
            padding: 8px 12px;
            font-size: 13px;
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--light-text);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
            width: calc(100% - 5px);
            box-sizing: border-box;
        }
        
        .submenu li:hover, .submenu li:focus {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
            outline: none;
        }
        
        .submenu li[data-active="true"] {
            background-color: rgba(22, 160, 133, 0.3);
            border-left: 3px solid var(--active-color);
        }
        
        /* 内容区域 */
        .content {
            display: flex;
            margin-left: calc(var(--nav-width) + 20px);
            padding: 0;
            background-color: #fff;
            border-left: 1px solid var(--border-color);
            transition: margin-left var(--transition-time) ease;
            position: relative;
            height: 100vh;
            overflow: hidden;
        }
        
        iframe {
            border: none;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #fff;
        }
        
        #iframe1, #iframe2 {
            width: 50%;
            height: 100vh;
            visibility: visible;
            transition: visibility var(--transition-time) ease;
        }
        
        #iframe3-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            visibility: hidden;
            z-index: 10;
        }
        
        #iframe3 {
            width: 100%;
            height: 100%;
        }
        
        /* 导航切换按钮 */
        .toggle-nav {
            position: fixed;
            top: 3px;
            left: calc(var(--nav-width) - 13px);
            font-size: 18px;
            cursor: pointer;
            color: var(--light-text);
            background-color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-time) ease;
            z-index: 25;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-nav:hover, .toggle-nav:focus {
            background-color: var(--secondary-dark);
            outline: none;
            transform: scale(1.1);
        }
        
        /* 加载指示器 */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--loading-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            visibility: hidden;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: var(--text-color);
        }
        
        /* 面包屑导航 */
        .breadcrumb {
            position: fixed;
            top: 2px;
            left: calc(var(--nav-width) + 28px);
            right: 7px;
            z-index: 15;
            background-color: white;
            padding: 10px 10px;
            border-radius: 7px;
            font-size: 14px;
            display: flex;
            align-items: center;
            height: 14px;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-time) ease;
        }
        
        /* 导航栏折叠时的面包屑导航 */
        .nav[style*="translateX(-100%)"] ~ .breadcrumb {
            left: 7px;
            right: 7px;
            padding: 10px 30px;
        }

        .breadcrumb span {
            margin: 0 5px;
            color: var(--secondary-color);
        }
        
        .breadcrumb .separator {
            margin: 0 8px;
            color: var(--text-color);
        }
        
        .breadcrumb .current-page {
            font-weight: bold;
            color: var(--secondary-dark);
        }
        
        /* 错误提示 */
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #ffebee;
            color: #c62828;
            padding: 10px 15px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 40;
            display: none;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            :root {
                --nav-width: 120px;
                --menu-item-height: 36px;
            }
            
            .nav button {
                padding: 0 10px;
                font-size: 12px;
            }
            
            .submenu li {
                font-size: 11px;
                padding: 6px 8px;
            }
            
            .nav h2 {
                font-size: 14px;
            }
            
            #iframe1, #iframe2 {
                width: 100%;
            }
            
            .breadcrumb {
                left: 20px !important;
                right: 20px !important;
                font-size: 12px;
            }
        }
        
        /* 键盘焦点样式 */
        *:focus {
            outline: 2px solid var(--secondary-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="nav" id="nav" role="navigation" aria-label="主导航菜单">
        <h2>智 汇 单 据</h2>
        <button onclick="toggleSubMenu(this, 'submenu1')" id="button1" data-active="true" aria-expanded="false" aria-controls="submenu1">
            <span>数 据 登 记</span>
            <span class="arrow" aria-hidden="true">&#9658;</span>
        </button>
        <ul class="submenu" id="submenu1" role="menu">
            <li role="menuitem" onclick="showDefaultScreen()" data-active="true" tabindex="0">收 单 登 记</li>
            <li role="menuitem" onclick="changePage('https://web.wps.cn/wo/sl/v323RrnC?app_id=3emRYl1NtiCvf4FJG9wZ0e', this)" tabindex="0">打单做账登记</li>
            <li role="menuitem" onclick="changePage('https://web.wps.cn/wo/sl/v32OIb5v?app_id=7ipoVBb5nm7xzBEi2oFqkG', this)" tabindex="0">异常单登记</li>
        </ul>
        <button onclick="toggleSubMenu(this, 'submenu2')" id="button2" data-active="false" aria-expanded="false" aria-controls="submenu2">
            <span>数 据 管 理</span>
            <span class="arrow" aria-hidden="true">&#9658;</span>
        </button>
        <ul class="submenu" id="submenu2" role="menu">
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v11p8MmT', this)" tabindex="0">收 单 数 据</li>
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v1jOqt2', this)" tabindex="0">代 理 数 据</li>
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v11yP7M2', this)" tabindex="0">打单做账数据</li>
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v1NM4FF', this)" tabindex="0">异常单数据</li>
        </ul>
        <button onclick="toggleSubMenu(this, 'submenu3')" id="button3" data-active="false" aria-expanded="false" aria-controls="submenu3">
            <span>数 据 分 析</span>
            <span class="arrow" aria-hidden="true">&#9658;</span>
        </button>
        <ul class="submenu" id="submenu3" role="menu">
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v12mnYEt', this)" tabindex="0">数 据 统 计</li>
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v1vFrtB', this)" tabindex="0">数据可视化</li>
        </ul>
        <button onclick="toggleSubMenu(this, 'submenu4')" id="button4" data-active="false" aria-expanded="false" aria-controls="submenu4">
            <span>数 据 查 询</span>
            <span class="arrow" aria-hidden="true">&#9658;</span>
        </button>
        <ul class="submenu" id="submenu4" role="menu">
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v12uVuyX', this)" tabindex="0">收单状态查询</li>
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v11MkQ2e', this)" tabindex="0">异常单展示</li>
        </ul>
        <button onclick="toggleSubMenu(this, 'submenu5')" id="button5" data-active="false" aria-expanded="false" aria-controls="submenu5">
            <span>关 于 系 统</span>
            <span class="arrow" aria-hidden="true">&#9658;</span>
        </button>
        <ul class="submenu" id="submenu5" role="menu">
            <li role="menuitem" onclick="changePage('https://www.kdocs.cn/wo/sl/v121tHvL', this)" tabindex="0">员工号绑定</li>
            <li role="menuitem" onclick="changePage('https://account.wps.cn/?accessid=AK20210823OPGONG&qrcode=kdocs&from=v1-web-kdocs-login&cb=https%3A%2F%2Faccount.wps.cn%2Fapi%2Fv3%2Fsession%2Fcorrelate%2Fredirect%3Ft%3D1743409611665%26appid%3D375024576%26cb%3Dhttps%253A%252F%252Fwww.kdocs.cn%252FsingleSign4CST%253Fcb%253Dhttps%25253A%25252F%25252Fwww.kdocs.cn%25252Fl%25252Fcq01Y5LPr8jG%25253FR%25253DL1MvMjQ%25253D&autologin=false', this)" tabindex="0">切 换 账 号</li>
            <li role="menuitem" onclick="changePage('https://kdocs.cn/l/cqekWkKdKPLM', this)" tabindex="0">系 统 说 明</li>
        </ul>
    </div>
    
    <div class="breadcrumb" id="breadcrumb">
        <span>智汇单据</span>
        <span class="separator">></span>
        <span>数据登记</span>
        <span class="separator">></span>
        <span class="current-page">收单登记</span>
    </div>
    
    <div class="content" id="content">
        <iframe id="iframe1" src="https://www.kdocs.cn/wo/sl/v11p8MmT" frameborder="0" title="收单数据" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
        <iframe id="iframe2" src="https://www.kdocs.cn/l/cqOBfg5woE11?from=docs&embed=1&hide=1" frameborder="0" title="收单登记" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
        <div id="iframe3-container">
            <iframe id="iframe3" src="" frameborder="0" title="内容页面" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
        </div>
    </div>
    
    <button class="toggle-nav" onclick="toggleNav()" id="toggleNav" aria-label="切换导航栏">&#215;</button>
    
    <div class="loading" id="loading">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">加载中，请稍候...</div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>
    
    <script>
        // 预加载常用页面
        const preloadUrls = [
            'https://web.wps.cn/wo/sl/v323RrnC?app_id=3emRYl1NtiCvf4FJG9wZ0e',
            'https://www.kdocs.cn/wo/sl/v11p8MmT',
            'https://www.kdocs.cn/l/cqOBfg5woE11'
        ];
        
        // 状态管理
        const appState = {
            currentPage: 'default',
            activeMenu: 'submenu1',
            navFolded: false,
            breadcrumb: ['智汇单据', '数据登记', '收单登记']
        };
        
        // DOM元素缓存
        const domElements = {
            nav: document.getElementById('nav'),
            content: document.getElementById('content'),
            iframe1: document.getElementById('iframe1'),
            iframe2: document.getElementById('iframe2'),
            iframe3: document.getElementById('iframe3'),
            iframe3Container: document.getElementById('iframe3-container'),
            toggleButton: document.getElementById('toggleNav'),
            loading: document.getElementById('loading'),
            errorMessage: document.getElementById('errorMessage'),
            breadcrumb: document.getElementById('breadcrumb')
        };
        
        // 初始化函数
        function init() {
            // 默认折叠所有子菜单
            document.querySelectorAll('.submenu').forEach(menu => {
                menu.style.display = 'none';
            });
            document.querySelectorAll('.nav button').forEach(button => {
                button.setAttribute('aria-expanded', 'false');
                button.querySelector('.arrow').style.transform = 'rotate(0deg)';
            });
            
            showDefaultScreen();
            setupEventListeners();
            preloadResources();
            setupKeyboardNavigation();
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 导航栏鼠标悬停效果
            domElements.toggleButton.addEventListener('mouseenter', handleNavHover);
            domElements.nav.addEventListener('mouseleave', handleNavLeave);
            
            // 错误处理
            window.addEventListener('error', handleGlobalError);
            
            // iframe加载事件
            [domElements.iframe1, domElements.iframe2, domElements.iframe3].forEach(iframe => {
                iframe.addEventListener('load', hideLoading);
                iframe.addEventListener('error', () => showError(`${iframe.id}加载失败`));
            });
        }
        
        // 设置键盘导航
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                // ESC键返回默认视图
                if (e.key === 'Escape' && appState.currentPage !== 'default') {
                    showDefaultScreen();
                }
                
                // Alt+1 切换到数据登记
                if (e.altKey && e.key === '1') {
                    document.getElementById('button1').click();
                }
                
                // Alt+2 切换到数据管理
                if (e.altKey && e.key === '2') {
                    document.getElementById('button2').click();
                }
            });
        }
        
        // 预加载资源
        function preloadResources() {
            preloadUrls.forEach(url => {
                const link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = url;
                document.head.appendChild(link);
            });
        }
        
        // 显示加载状态
        function showLoading() {
            domElements.loading.style.visibility = 'visible';
        }
        
        // 隐藏加载状态
        function hideLoading() {
            domElements.loading.style.visibility = 'hidden';
        }
        
        // 显示错误信息
        function showError(message) {
            domElements.errorMessage.textContent = message;
            domElements.errorMessage.style.display = 'block';
            setTimeout(() => {
                domElements.errorMessage.style.display = 'none';
            }, 5000);
        }
        
        // 全局错误处理
        function handleGlobalError(event) {
            console.error('全局错误:', event.error);
            showError('发生意外错误，请刷新页面');
        }
        
        // 导航栏悬停处理
        function handleNavHover() {
            if (appState.navFolded) {
                domElements.nav.style.transform = 'translateX(0)';
            }
        }
        
        // 导航栏离开处理
        function handleNavLeave() {
            if (appState.navFolded) {
                domElements.nav.style.transform = 'translateX(-100%)';
            }
        }
        
        // 切换子菜单
        function toggleSubMenu(button, submenuId) {
            const submenu = document.getElementById(submenuId);
            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            
            // 关闭所有其他子菜单
            document.querySelectorAll('.submenu').forEach(menu => {
                if (menu.id !== submenuId) {
                    menu.style.display = 'none';
                    const btn = menu.previousElementSibling;
                    btn.setAttribute('aria-expanded', 'false');
                    btn.querySelector('.arrow').style.transform = 'rotate(0deg)';
                }
            });
            
            // 切换当前子菜单
            if (isExpanded) {
                submenu.style.display = 'none';
                button.setAttribute('aria-expanded', 'false');
                button.querySelector('.arrow').style.transform = 'rotate(0deg)';
            } else {
                submenu.style.display = 'block';
                button.setAttribute('aria-expanded', 'true');
                button.querySelector('.arrow').style.transform = 'rotate(90deg)';
                submenu.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // 切换导航栏
        function toggleNav() {
            appState.navFolded = !appState.navFolded;
            
            domElements.nav.style.transform = appState.navFolded ? 'translateX(-100%)' : 'translateX(0)';
            domElements.content.style.marginLeft = appState.navFolded ? '0' : 'calc(var(--nav-width) + 20px)';
            
            domElements.toggleButton.innerHTML = appState.navFolded ? '&#9776;' : '&#215;';
            domElements.toggleButton.style.left = appState.navFolded ? '10px' : 'calc(var(--nav-width) - 20px)';
            
            domElements.toggleButton.setAttribute('aria-expanded', !appState.navFolded);
        }
        
        // 更改页面
        async function changePage(url, button) {
            try {
                showLoading();
                updateAppState(url, button);
                updateUIState(button);
                
                domElements.iframe3.src = url;
                domElements.iframe3Container.style.visibility = 'visible';
                domElements.iframe1.style.visibility = 'hidden';
                domElements.iframe2.style.visibility = 'hidden';
                
                updateBreadcrumb(button);
            } catch (error) {
                console.error('页面切换错误:', error);
                showError('页面加载失败，请重试');
            }
        }
        
        // 更新应用状态
        function updateAppState(url, button) {
            appState.currentPage = url;
            appState.activeMenu = button.parentElement.id;
            
            const mainMenu = button.parentElement.previousElementSibling.textContent.trim();
            const subMenu = button.textContent.trim();
            appState.breadcrumb = ['智汇单据', mainMenu, subMenu];
        }
        
        // 更新UI状态
        function updateUIState(button) {
            // 更新按钮状态
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.dataset.active = 'false';
                btn.setAttribute('aria-current', 'false');
            });
            
            const parentButton = button.parentElement.previousElementSibling;
            parentButton.dataset.active = 'true';
            parentButton.setAttribute('aria-current', 'true');
            
            // 更新子菜单按钮状态
            document.querySelectorAll('.submenu li').forEach(item => {
                item.dataset.active = 'false';
                item.setAttribute('aria-current', 'false');
            });
            
            button.dataset.active = 'true';
            button.setAttribute('aria-current', 'true');
        }
        
        // 更新面包屑导航
        function updateBreadcrumb(button) {
            const mainMenu = button.parentElement.previousElementSibling.textContent.trim();
            const subMenu = button.textContent.trim();
            
            domElements.breadcrumb.innerHTML = `
                <span>智汇单据</span>
                <span class="separator">></span>
                <span>${mainMenu}</span>
                <span class="separator">></span>
                <span class="current-page">${subMenu}</span>
            `;
        }
        
        // 显示默认屏幕
        function showDefaultScreen() {
            domElements.iframe1.style.visibility = 'visible';
            domElements.iframe2.style.visibility = 'visible';
            domElements.iframe3Container.style.visibility = 'hidden';
            domElements.iframe3.src = '';
            
            // 更新状态
            appState.currentPage = 'default';
            appState.activeMenu = 'submenu1';
            appState.breadcrumb = ['智汇单据', '数据登记', '收单登记'];
            
            // 更新UI - 保持第一个按钮激活但不展开子菜单
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.dataset.active = 'false';
                btn.setAttribute('aria-current', 'false');
                btn.setAttribute('aria-expanded', 'false');
                btn.querySelector('.arrow').style.transform = 'rotate(0deg)';
            });
            
            const defaultButton = document.getElementById('button1');
            defaultButton.dataset.active = 'true';
            defaultButton.setAttribute('aria-current', 'true');
            
            // 折叠所有子菜单
            document.querySelectorAll('.submenu').forEach(menu => {
                menu.style.display = 'none';
            });
            
            document.querySelectorAll('.submenu li').forEach(item => {
                item.dataset.active = 'false';
                item.setAttribute('aria-current', 'false');
            });
            
            const defaultMenuItem = document.querySelector('#submenu1 li');
            defaultMenuItem.dataset.active = 'true';
            defaultMenuItem.setAttribute('aria-current', 'true');
            
            // 更新面包屑导航
            domElements.breadcrumb.innerHTML = `
                <span>智汇单据</span>
                <span class="separator">></span>
                <span>数据登记</span>
                <span class="separator">></span>
                <span class="current-page">收单登记</span>
            `;
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>